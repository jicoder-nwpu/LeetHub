<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>LeetHub</title>
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link th:href="@{/css/styles.css}" rel="stylesheet" />
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="position-fixed top-0 start-50" style="z-index: 9999">
            <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <svg class="bd-placeholder-img rounded me-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#007aff"></rect></svg>
                    <strong class="me-auto">Tag</strong>
                    <button type="button" class="btn-close" data-bs-delay="1000" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div id="toast_msg" class="toast-body"></div>
            </div>
        </div>
        <header th:replace="tag_header.html"></header>
        <div id="layoutSidenav">
            <aside th:replace="aside.html"></aside>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container px-4 px-lg-5 mt-5">
                        <div class="modal fade" id="removeModal" tabindex="-1" aria-labelledby="removeModalCenterTitle" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="removeModalCenterTitle">Warning</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>确定要删除此标签吗？</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                        <a id="remove_link" href="" class="btn btn-link bg-primary text-white">Yes</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" id="changeModal" tabindex="-1" aria-labelledby="changeModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="changeModalLabel">Change Label information</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                            <div class="mb-3">
                                                <label for="recipient-name" class="col-form-label">Recipient:</label>
                                                <input type="text" class="form-control" id="recipient-name">
                                            </div>
                                            <div class="mb-3">
                                                <label for="message-text" class="col-form-label">Message:</label>
                                                <textarea class="form-control" id="message-text"></textarea>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary">Send message</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="addModalLabel">Add a new tag</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                            <div class="mb-3">
                                                <label for="recipient-name" class="col-form-label">Tag name:</label>
                                                <input type="text" class="form-control" id="tag_name">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" onclick="insertTag()">Commit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div th:if="${tags.size()} gt 0">
                            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                                <div th:each="tag:${tags}">
                                    <div class="col mb-5">
                                        <div class="card bg-body h-100">
                                            <!-- Product details-->
                                            <div class="card-body p-4">
                                                <div class="text-center">
                                                    <!-- Label name-->
                                                    <h5 class="fw-bolder" th:text="${tag.name}"></h5>
                                                    <!-- Label Problem rating-->
                                                    <div class="progress">
                                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 10%" th:text="${tag.count}"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Product actions-->
                                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                                <div class="d-flex justify-content-between">
                                                    <button type="button" class="btn btn-primary mt-auto" data-bs-toggle="modal" data-bs-whatever="你好" data-bs-target="#changeModal">
                                                        Change
                                                    </button>
                                                    <button type="button" class="btn btn-secondary mt-auto" data-bs-toggle="modal" th:attr="data-bs-whatever=${tag.tag_id}" data-bs-target="#removeModal">
                                                        Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div th:if="${tags.size()} le 0">
                            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                                <h4>点击右上角按钮创建Tag</h4>
                            </div>
                        </div>
                    </div>
                </main>
                <footer th:replace="footer.html"></footer>
            </div>
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script th:src="@{/webjars/jquery/2.1.0/dist/jquery.js}"></script>
        <script src="/js/scripts.js"></script>
        <script>
            var exampleModal = document.getElementById('removeModal')
            exampleModal.addEventListener('show.bs.modal', function (event) {
                // Button that triggered the modal
                var button = event.relatedTarget
                // Extract info from data-bs-* attributes
                var tag_id = button.getAttribute('data-bs-whatever')
                var remove_button = exampleModal.querySelector('.modal-footer #remove_link')
                remove_button.href = '/tag/delete/' + tag_id
            })
        </script>
        <script>
            function insertTag() {
                var tagModal = document.getElementById('tag_name');
                var tag_name = tagModal.value.replace(/^\s*|\s*$/g,"");
                var toastLive = document.getElementById('liveToast');
                var toast_msg = document.getElementById('toast_msg');
                var toast = new bootstrap.Toast(toastLive);
                if (tag_name == undefined || tag_name == null || tag_name == ''){
                    toast_msg.textContent='请为标签起个名字！';
                    toast.show();
                    return;
                };
                var data = {
                    "name": tag_name
                };
                $.ajax({
                    url: "/tag/insert",
                    type: "POST",  //默认值: "GET"请求方式 ("POST" 或 "GET")
                    data: JSON.stringify(data),
                    dataType: "json",
                    contentType:"application/json;charset=UTF-8",
                    success: function(data){      // 回调结果，如果成功
                        toast_msg.textContent=data['message'];
                        toast.show();
                        if (data['status'] == 1){
                            location.reload();
                        };
                    },
                    error: function() {
                        alert("发生错误，请反馈！");
                    }
                })
            };
        </script>
    </body>
</html>
